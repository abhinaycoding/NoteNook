[{"filePath":"C:\\Users\\admin\\Desktop\\Student saas\\src\\components\\FocusTimer.jsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect contains a call to 'setShowConfetti'. Without a list of dependencies, this can lead to an infinite chain of updates. To fix this, pass [] as a second argument to the useEffect Hook.","line":86,"column":3,"nodeType":"Identifier","endLine":86,"endColumn":12,"suggestions":[{"desc":"Add dependencies array: []","fix":{"range":[2546,2546],"text":", []"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\n  87 |     if (_done && !prevDone.current) {\n  88 |       // eslint-disable-next-line react-hooks/set-state-in-effect -- intentional: reacts to module-level _done\n> 89 |       setShowConfetti(true)\n     |       ^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  90 |       setTimeout(() => setShowConfetti(false), 3500)\n  91 |     }\n  92 |     prevDone.current = _done","line":89,"column":7,"nodeType":null,"endLine":89,"endColumn":22,"suppressions":[{"kind":"directive","justification":"intentional: reacts to module-level _done"}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useRef } from 'react'\r\nimport { supabase } from '../lib/supabase'\r\nimport { useAuth } from '../contexts/AuthContext'\r\nimport { useToast } from '../contexts/ToastContext'\r\nimport Confetti from './Confetti'\r\nimport './FocusTimer.css'\r\n\r\nconst PRESETS = [25, 45, 60]\r\n\r\n// ΓöÇΓöÇ Module-level timer state (survives page navigation) ΓöÇΓöÇ\r\nlet _selected = 25\r\nlet _left = 25 * 60\r\nlet _running = false\r\nlet _done = false\r\nlet _saved = false\r\nlet _timerId = null\r\nlet _subs = []\r\nconst notify = () => _subs.forEach(fn => fn())\r\n\r\nconst timerStart = () => {\r\n  if (_done) { _left = _selected * 60; _done = false; _saved = false }\r\n  if (_running) return\r\n  _running = true\r\n  clearInterval(_timerId)\r\n  _timerId = setInterval(() => {\r\n    if (_left <= 1) {\r\n      clearInterval(_timerId)\r\n      _left = 0; _running = false; _done = true\r\n    } else {\r\n      _left -= 1\r\n    }\r\n    notify()\r\n  }, 1000)\r\n  notify()\r\n}\r\n\r\nconst timerPause = () => {\r\n  clearInterval(_timerId)\r\n  _running = false\r\n  notify()\r\n}\r\n\r\nconst timerReset = () => {\r\n  clearInterval(_timerId)\r\n  _running = false; _done = false; _saved = false\r\n  _left = _selected * 60\r\n  notify()\r\n}\r\n\r\nconst timerPreset = (min) => {\r\n  if (_running) return\r\n  clearInterval(_timerId)\r\n  _selected = min; _left = min * 60\r\n  _running = false; _done = false; _saved = false\r\n  notify()\r\n}\r\n\r\nconst FocusTimer = () => {\r\n  const { user } = useAuth()\r\n  const toast = useToast()\r\n  const [, tick] = useState(0)\r\n  const [showConfetti, setShowConfetti] = useState(false)\r\n  const prevDone = useRef(false)\r\n\r\n  useEffect(() => {\r\n    const fn = () => tick(n => n + 1)\r\n    _subs.push(fn)\r\n    return () => { _subs = _subs.filter(s => s !== fn) }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (_done && user && !_saved) {\r\n      _saved = true\r\n      supabase.from('sessions').insert([{\r\n        user_id: user.id,\r\n        duration_seconds: _selected * 60,\r\n        completed: true,\r\n        created_at: new Date().toISOString(),\r\n      }]).then(({ error }) => {\r\n        if (!error) toast(`${_selected}m session logged. Well done, Scholar.`, 'success', 4000)\r\n      }).catch(e => console.error(e.message))\r\n    }\r\n  }, [user, toast])\r\n\r\n  // Trigger confetti on session complete\r\n  useEffect(() => {\r\n    if (_done && !prevDone.current) {\r\n      // eslint-disable-next-line react-hooks/set-state-in-effect -- intentional: reacts to module-level _done\r\n      setShowConfetti(true)\r\n      setTimeout(() => setShowConfetti(false), 3500)\r\n    }\r\n    prevDone.current = _done\r\n  })\r\n\r\n  const mm = Math.floor(_left / 60).toString().padStart(2, '0')\r\n  const ss = (_left % 60).toString().padStart(2, '0')\r\n  const progress = (_selected * 60 - _left) / (_selected * 60)\r\n  const label = _done ? 'Restart' : (_left < _selected * 60 && !_running) ? 'Resume' : 'Commence'\r\n  const stateLabel = _done ? 'Done' : _running ? 'ON' : 'ΓÇö'\r\n\r\n  // SVG arc\r\n  const R = 44\r\n  const CIRC = 2 * Math.PI * R\r\n  const offset = CIRC * (1 - progress)\r\n\r\n  const digitClass = [\r\n    'timer-digits',\r\n    _running ? 'timer-digits--running' : '',\r\n    _done ? 'timer-digits--done' : '',\r\n  ].join(' ')\r\n\r\n  return (\r\n    <div className=\"timer-widget\">\r\n      <Confetti active={showConfetti} />\r\n\r\n      {/* Preset chips */}\r\n      <div className=\"timer-presets\">\r\n        {PRESETS.map(min => (\r\n          <button\r\n            key={min}\r\n            onClick={() => timerPreset(min)}\r\n            disabled={_running}\r\n            className={`timer-preset-btn ${_selected === min ? 'active' : ''}`}\r\n          >\r\n            {min}m\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Main display: arc ring + big digits side by side */}\r\n      <div className=\"timer-display\">\r\n        {/* Compact arc ring */}\r\n        <div className=\"timer-arc-wrap\">\r\n          <svg className=\"timer-arc-svg\" viewBox=\"0 0 100 100\">\r\n            <circle className=\"timer-arc-track\" cx=\"50\" cy=\"50\" r={R} />\r\n            <circle\r\n              className={`timer-arc-fill ${_done ? 'timer-arc-fill--done' : ''}`}\r\n              cx=\"50\" cy=\"50\" r={R}\r\n              strokeDasharray={CIRC}\r\n              strokeDashoffset={offset}\r\n            />\r\n          </svg>\r\n          <div className=\"timer-arc-label\">{stateLabel}</div>\r\n        </div>\r\n\r\n        {/* Big digits */}\r\n        <div className=\"timer-digits-block\">\r\n          <div className={digitClass}>\r\n            {mm}\r\n            <span className={`timer-colon ${!_running ? 'timer-colon--paused' : ''}`}>:</span>\r\n            {ss}\r\n          </div>\r\n          <div className=\"timer-session-info\">\r\n            {_selected}min ┬╖ {_done ? 'Session complete' : _running ? 'FocusingΓÇª' : 'Ready to begin'}\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Progress bar */}\r\n      <div className=\"timer-bar-track\">\r\n        <div\r\n          className={`timer-bar-fill ${_running ? 'timer-bar-fill--running' : ''}`}\r\n          style={{\r\n            width: `${progress * 100}%`,\r\n            backgroundColor: _done ? 'var(--accent)' : 'var(--primary)'\r\n          }}\r\n        />\r\n      </div>\r\n\r\n      {_done && (\r\n        <p className=\"timer-done-msg\">\r\n          {_saved ? 'Γ£ô Session logged to Analytics.' : 'Session complete!'}\r\n        </p>\r\n      )}\r\n\r\n      {/* Controls */}\r\n      <div className=\"timer-controls\">\r\n        <button onClick={timerReset} className=\"timer-btn\">Reset</button>\r\n        {_running\r\n          ? <button onClick={timerPause} className=\"timer-btn timer-btn-pause\">Pause</button>\r\n          : <button onClick={timerStart} className=\"timer-btn timer-btn-primary\">{label}</button>\r\n        }\r\n      </div>\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default FocusTimer\r\n","usedDeprecatedRules":[]}]
